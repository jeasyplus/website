## Elasticsearch（ES）

ES基于分布式架构和倒排索引存储，提供搜索、分析和聚合功能，适用于各种场景，如全文搜索、日志分析、实时监控等。

## 倒排索引（Inverted Index）

用于快速查找文档的索引结构。

倒排索引使用由**词项指向文档**的方式构建索引。

每个**词项**都维护了一个包含了包含该词项的**文档列表**。这个**文档列表**记录了所有包含该**词项的文档的信息**，比如文档的**标识符、位置、频率**等。

通过倒排索引，可以快速地根据关键词查询到包含该关键词的文档。

## 与数据库同步

### 双写
```java
db.save(obj)
es.save(ojb)
```
优点明显，缺点更明显。

### MQ消息

数据先入MQ，db和es各自从自己的队列取消息，进行消费和重试。

缺点就是数量有延迟。

### 定时扫描DB

定时检测数据库的变化，批量更新。

优点没有代码入侵，缺点实时性太差，性能上不好，容易对数库造成压力。

### 监听BinLog

引入第三方框架（如：Canal），使用binlog数据更新es

优点是没有代码入侵，缺点需要引入第三方框架，存在一定的延迟。

Canal 是阿里巴巴开源的一个用于实时数据同步和消息订阅的中间件工具。 可以方便地实现数据库与其他系统（如Elasticsearch）之间的实时数据同步。

## 优化

### 硬件和资源：

确保为 Elasticsearch 分配足够的硬件资源，包括 CPU、内存、磁盘和网络带宽。合理的硬件配置可以提供更好的性能和吞吐量。

### 索引设计：

优化索引设计是提升 ES 性能的关键。考虑以下方面：

+ **映射（Mapping）**：定义合适的字段类型、分词器和索引选项，避免不必要的字段索引。

+ **分片和副本**：根据数据量和查询负载来合理划分分片和副本数量，以实现负载均衡和高可用性。

+ **索引设置**：根据数据的读写特性和查询需求，调整索引设置，如刷新间隔、刷新策略和合理的索引缓存大小。

+ **查询优化**：优化查询可以显著提高 ES 的性能。以下是一些查询优化的建议：

+ **使用过滤器（Filter）**：对于不需要计算相关性的查询条件，使用过滤器而不是查询可以提高性能。

+ **避免全文搜索**：全文搜索是强大但开销较大的操作，如果不需要全文搜索功能，可以考虑使用精确匹配查询（Term Query）等更轻量级的查询方式。

+ **使用聚合查询**：聚合查询可以对数据进行统计和分析，提供快速的汇总结果。 

### 分片和节点调整：

通过增加节点或调整分片分布，可以实现负载均衡和提高并行处理能力。同时，合理配置分片大小和副本数，避免单个分片过大或过小。

### 缓存设置：

Elasticsearch 使用缓存来加速查询和聚合操作。合理配置查询缓存和字段数据缓存的大小和过期策略，以优化性能。

### JVM 调优：

根据实际情况调整 Elasticsearch JVM 的参数，包括堆内存大小、垃圾回收机制和线程池设置等。

### 网络和安全配置：

确保网络连接稳定，并进行必要的安全配置，如启用 TLS/SSL 加密和访问控制。

### 监控和日志：

定期监控 Elasticsearch 集群的性能指标和日志，以及时发现潜在的问题并进行调整和优化。

















