# JUC-Java

## AQS

AQS是构建同步器的框架，设计目标是支持构建各种类型的同步器。

例：如锁、信号量、倒计时门栓等。

+ 锁（Lock）：锁是一种用于实现线程互斥访问共享资源的机制。
+ 信号量（Semaphore）：信号量是一种用于控制并发访问的计数器。
+ 倒计时门栓（CountDownLatch）：倒计时门栓是一种用于协调多个线程之间的等待和同步的机制。

### AQS概念

AQS内部维护一种先进先出的队列和一个使用了volatile修饰的状态位。

AQS提供了底层的状态管理、线程的阻塞和唤醒等功能，通过继承AQS可以实现共享锁和排他锁。

**AQS独占锁（排他锁）的实现思路：**
+ 内部状态值（state）为 0 表示锁是未被持有的状态，为 1 表示锁是被某个线程所持有的状态。
+ 当一个线程想要获取锁时，会先尝试通过 CAS（Compare and Set）操作将状态值从 0 修改为 1，如果成功则获取到了锁，否则会将线程阻塞并加入等待队列。
+ 当持有锁的线程释放锁时，会将状态值设置为 0，并从等待队列中唤醒一个等待的线程来获取锁。


## CAS

CAS（Compare and Swap，比较并交换）是 Java 中的一种并发原语，属于一种乐观锁机制，用于实现多线程环境下的原子操作，解决多线程并发访问共享变量时的数据竞争问题。

CAS 操作通常包含三个操作数：一个内存位置（共享变量）、期望的值和新值。它的执行过程如下：

1、读取内存位置的当前值（旧值）。
2、比较旧值与期望的值是否相等。如果相等，则说明内存位置的值没有被其他线程修改，可以进行下一步操作；如果不相等，则说明有其他线程修改了内存位置的值，操作失败。
3、如果比较相等，将新值写入内存位置。
4、返回操作是否成功的结果。

### ABA问题

使用 CAS（Compare and Swap）操作时可能遇到的一种并发问题。

在 CAS 操作中，ABA 问题可能会导致一些意想不到的结果和潜在的问题。例如，在某些情况下，对于某个共享变量，一个线程可能会错误地认为它没有被修改，从而可能导致不一致或错误的结果。

为了解决 ABA 问题，可以使用版本号或标记来跟踪变量的变化。在每次修改变量值时，都增加版本号或修改标记。这样，在比较和交换时，除了比较值外，还需要比较版本号或标记。如果版本号或标记不匹配，说明变量已经发生过变化，CAS 操作将失败。












