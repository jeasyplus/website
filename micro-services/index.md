# 微服务

## 分布式和微服务的区别

**微服务架构**是分布式架构的一种。

**分布式架构**有很多种，包括了C/S架构、P2P架构、SOA架构、微服务架构、Serverless架构等。


## 微服务

微服务的目的是有效的拆分应用，实现敏捷开发和部署。

## 微服务的具体特征

+ 一系列独立的服务共同构成一个系统。
+ 单独部署，运行在自己的进程中。
+ 每个服务为独立的业务开发。
+ 分布式的管理。

## 微服务具体实践

+ 客户端如何访问这些服务？
  + 一个代理或者叫API Gateway的组件
+ 服务之间如何通信？
  + 同步调用：REST（JAX-RS）、RPC（Dubbo）
  + 异步消息调用(Kafka, Notify, MetaQ)
+ 这么多服务，怎么找?
  + 客户端查找：架构简单，扩展灵活，只对服务注册器依赖。缺点是客户端要维护所有调用服务的地址，有技术难度，大公司都有成熟的内部框架，比如Dubbo。
  + 服务端查找：简单，所有服务对于前台调用方透明，一般在小公司在云服务上部署的应用采用的比较多。
+ 服务挂了怎么办？
  + 重试机制
  + 限流
  + 熔断机制
  + 负载均衡
  + 降级（本地缓存）

## 微服务的应用
+ API Gateway
+ 服务间调用
+ 服务发现
+ 服务容错
+ 服务部署
+ 数据调用

## 微服务拆分

+ 将不同功能的模块单独拆分作为一个微服务。比如：用户服务、订单服务、物流服务等，每个服务都作为微服务部署，对外提供服务。
+ 不可忽视微服务和组织架构之间的关系，按康威定律来说，应用架构和组织架构应是一一对应的。这样更加容易的进行微服务的开发与维护，做到最小的成本沟通和最快速度的迭代。比如：中台，可能有中台相关的微服务，如：交易服务、店铺服务等。
+ 按照应用类型进行拆分。有些应用主要处理在线业务，有些系统处理离线业务，把他们拆分开，避免互相影响。

## 微服务架构的服务治理方案

服务注册与发现、负载均衡、容错与熔断、限流与流量控制、服务监控与追踪等，这些都是服务治理的一部分。

### 服务注册与发现
+ ZooKeeper
+ Consul
+ Eureka

### 负载均衡

+ Ribbon
+ Nginx

### 容错与熔断
+ Hystrix
+ Sentinel

### 限流与流量控制

+ Rate Limiter：Google开源的限流框架，可以实现对访问频率的限制。
+ Istio：由Google、IBM和Lyft等公司共同推出的一个服务网格框架，可以实现对服务流量的控制和管理。
+ Sentinel：也支持限流。

### 服务监控与追踪
+ Prometheus：由SoundCloud开源监控系统，可以实现对服务的实时监控和度量。
+ Zipkin：由Twitter开源的分布式追踪系统，可以实现对服务调用链的追。

## DevOps

强调软件开发和IT运维的紧密结合，以实现更快速、更频繁、更可靠的软件交付。

## 微服务中的CI/CD

+ CI：Continuous Integration，持续集成。
  + 持续集成是一种软件开发实践，要求开发者经常集成其变更，方式是将变更合并到主干（trunk）。

+ CD：Continuous Delivery，持续交付、持续部署。
  + 持续交付（CD）是一种软件开发实践，旨在早期、快速、可靠地发布高质量软件，以满足业务需求。
  + 持续部署（CD）指的是在持续集成完成后，直接向生产环境部署应用，或者是定期将新功能部署到生产环境的过程。

## ServiceMesh

一种新型的架构模式，用于解决微服务架构中的一些问题，如服务发现、服务间通信、负载均衡、安全、监控等。

主要思想是将服务之间的通信从服务代码中抽象出来，并在整个应用中提供一种统一的方式进行管理和控制。

常用于异构系统中，如：Java、C++、Python、PHP混合开发 ，用同一套架构体系对异构系统进行整合。

目前主流的Service Mesh产品包括Istio、Linkerd、Envoy等。


